!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("angular-mentions",["exports","@angular/core","@angular/common"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["angular-mentions"]={},t.ng.core,t.ng.common)}(this,(function(t,e,i){"use strict";function n(t){return r(t)?t.value:t.textContent}function o(t,e,i,a,l,c){if(void 0===c&&(c=!1),function(t){return null!=t&&("INPUT"==t.nodeName||"TEXTAREA"==t.nodeName||"#text"==t.nodeName)}(t)){var d=n(t);!function(t,e){r(t)?t.value=e:t.textContent=e}(t,d.substring(0,e)+a+d.substring(i,d.length)),s(t,e+a.length,l)}else if(!c){var f=h(l);if(f&&f.rangeCount>0){var p=f.getRangeAt(0).startOffset;o(f.anchorNode,p-(i-e),p,a,l,!0)}}}function r(t){return null!=t&&("INPUT"==t.nodeName||"TEXTAREA"==t.nodeName)}function s(t,e,i){if(void 0===i&&(i=null),r(t)&&t.selectionStart)t.focus(),t.setSelectionRange(e,e);else{var n=l(i).createRange();n.setStart(t,e),n.collapse(!0);var o=h(i);o.removeAllRanges(),o.addRange(n)}}function a(t,e){if(void 0===e&&(e=null),r(t))return t.value.slice(0,t.selectionStart).length;var i=h(e);if(i.rangeCount>0){var n=i.getRangeAt(0),o=n.cloneRange();return o.selectNodeContents(t),o.setEnd(n.endContainer,n.endOffset),o.toString().length}}function l(t){return t?t.contentWindow.document:document}function h(t){return t?t.contentWindow.getSelection():window.getSelection()}function c(t){var e="sel_"+(new Date).getTime()+"_"+Math.random().toString().substr(2),i=l(t?t.iframe:null),n=h(t?t.iframe:null),o=n.getRangeAt(0),r=i.createRange();r.setStart(n.anchorNode,o.startOffset),r.setEnd(n.anchorNode,o.startOffset),r.collapse(!1);var s=i.createElement("span");s.id=e,s.appendChild(i.createTextNode("\ufeff")),r.insertNode(s),n.removeAllRanges(),n.addRange(o);var a={left:0,top:s.offsetHeight};return function(t,e,i){var n=e,o=t?t.iframe:null;for(;n&&(null==t.parent||t.parent!=n);)i.left+=n.offsetLeft+n.clientLeft,i.top+=n.offsetTop+n.clientTop,!(n=n.offsetParent)&&o&&(n=o,o=null);n=e,o=t?t.iframe:null;for(;n!==l(null).body&&null!=n&&(null==t.parent||t.parent!=n);)n.scrollTop&&n.scrollTop>0&&(i.top-=n.scrollTop),n.scrollLeft&&n.scrollLeft>0&&(i.left-=n.scrollLeft),!(n=n.parentNode)&&o&&(n=o,o=null)}(t,s,a),s.parentNode.removeChild(s),a}var d=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],f="undefined"!=typeof window,p=f&&null!=window.mozInnerScreenX;var m=function(){function t(t){this.element=t,this.labelKey="label",this.itemClick=new e.EventEmitter,this.items=[],this.activeIndex=0,this.hidden=!1,this.dropUp=!1,this.styleOff=!1,this.coords={top:0,left:0},this.offset=0}return t.prototype.ngAfterContentChecked=function(){this.itemTemplate||(this.itemTemplate=this.defaultItemTemplate)},t.prototype.position=function(t,e){if(void 0===e&&(e=null),r(t))this.coords=function(t,e,i){if(!f)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var n=i&&i.debug||!1;if(n){var o=document.querySelector("#input-textarea-caret-position-mirror-div");o&&o.parentNode.removeChild(o)}var r=document.createElement("div");r.id="input-textarea-caret-position-mirror-div",document.body.appendChild(r);var s=r.style,a=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,l="INPUT"===t.nodeName;s.whiteSpace="pre-wrap",l||(s.wordWrap="break-word"),s.position="absolute",n||(s.visibility="hidden"),d.forEach((function(t){if(l&&"lineHeight"===t)if("border-box"===a.boxSizing){var e=parseInt(a.height),i=parseInt(a.paddingTop)+parseInt(a.paddingBottom)+parseInt(a.borderTopWidth)+parseInt(a.borderBottomWidth),n=i+parseInt(a.lineHeight);s.lineHeight=e>n?e-i+"px":e===n?a.lineHeight:"0"}else s.lineHeight=a.height;else s[t]=a[t]})),p?t.scrollHeight>parseInt(a.height)&&(s.overflowY="scroll"):s.overflow="hidden",r.textContent=t.value.substring(0,e),l&&(r.textContent=r.textContent.replace(/\s/g," "));var h=document.createElement("span");h.textContent=t.value.substring(e)||".",r.appendChild(h);var c={top:h.offsetTop+parseInt(a.borderTopWidth),left:h.offsetLeft+parseInt(a.borderLeftWidth),height:parseInt(a.lineHeight)};return n?h.style.backgroundColor="#aaa":document.body.removeChild(r),c}(t,t.selectionStart,null),this.coords.top=t.offsetTop+this.coords.top-t.scrollTop,this.coords.left=t.offsetLeft+this.coords.left-t.scrollLeft,this.offset=this.getBlockCursorDimensions(t).height;else if(e){var i={iframe:e,parent:e.offsetParent};this.coords=c(i)}else{var n=document.documentElement,o=(window.pageXOffset||n.scrollLeft)-(n.clientLeft||0),s=(window.pageYOffset||n.scrollTop)-(n.clientTop||0),a=c({iframe:e}),l=t.getBoundingClientRect();this.coords.top=a.top-l.top+t.offsetTop-s,this.coords.left=a.left-l.left+t.offsetLeft-o}this.positionElement()},Object.defineProperty(t.prototype,"activeItem",{get:function(){return this.items[this.activeIndex]},enumerable:!1,configurable:!0}),t.prototype.activateNextItem=function(){var t=this.list.nativeElement,e=t.getElementsByClassName("active").item(0);if(e){var i=e.nextSibling;if(i&&"LI"==i.nodeName){var n=i.getBoundingClientRect();n.bottom>t.getBoundingClientRect().bottom&&(t.scrollTop=i.offsetTop+n.height-t.clientHeight)}}this.activeIndex=Math.max(Math.min(this.activeIndex+1,this.items.length-1),0)},t.prototype.activatePreviousItem=function(){var t=this.list.nativeElement,e=t.getElementsByClassName("active").item(0);if(e){var i=e.previousSibling;if(i&&"LI"==i.nodeName)i.getBoundingClientRect().top<t.getBoundingClientRect().top&&(t.scrollTop=i.offsetTop)}this.activeIndex=Math.max(Math.min(this.activeIndex-1,this.items.length-1),0)},t.prototype.reset=function(){this.list.nativeElement.scrollTop=0,this.checkBounds()},t.prototype.checkBounds=function(){var t=this.coords.left,e=this.coords.top,i=this.dropUp,n=this.list.nativeElement.getBoundingClientRect();n.left+n.width>window.innerWidth&&(t-=n.left+n.width-window.innerWidth+10),n.top<0&&(i=!1),this.positionElement(t,e,i)},t.prototype.positionElement=function(t,e,i){void 0===t&&(t=this.coords.left),void 0===e&&(e=this.coords.top),void 0===i&&(i=this.dropUp);var n=this.element.nativeElement;e+=i?0:this.offset,n.className=i?"dropup":null,n.style.position="absolute",n.style.left=t+"px",n.style.top=e+"px"},t.prototype.getBlockCursorDimensions=function(t){var e=window.getComputedStyle(t);return{height:parseFloat(e.lineHeight),width:parseFloat(e.fontSize)}},t}();m.decorators=[{type:e.Component,args:[{selector:"mention-list",template:'\n    <ng-template #defaultItemTemplate let-item="item">\n      {{item[labelKey]}}\n    </ng-template>\n    <ul #list [hidden]="hidden" class="dropdown-menu scrollable-menu"\n      [class.mention-menu]="!styleOff" [class.mention-dropdown]="!styleOff && dropUp">\n      <li *ngFor="let item of items; let i = index"\n        [class.active]="activeIndex==i" [class.mention-active]="!styleOff && activeIndex==i">\n        <a class="dropdown-item" [class.mention-item]="!styleOff"\n          (mousedown)="activeIndex=i;itemClick.emit();$event.preventDefault()">\n          <ng-template [ngTemplateOutlet]="itemTemplate" [ngTemplateOutletContext]="{\'item\':item}"></ng-template>\n        </a>\n      </li>\n    </ul>\n    ',styles:[".mention-menu{background-clip:padding-box;background-color:#fff;border:1px solid rgba(0,0,0,.15);border-radius:.25em;color:#212529;display:none;float:left;font-size:1em;left:0;list-style:none;margin:.125em 0 0;min-width:11em;padding:.5em 0;position:absolute;text-align:left;top:100%;z-index:1000}.mention-item{background-color:transparent;border:0;clear:both;color:#212529;display:block;font-weight:400;line-height:1.5em;padding:.2em 1.5em;text-align:inherit;white-space:nowrap}.mention-active>a{background-color:#337ab7;color:#fff;outline:0;text-decoration:none}.scrollable-menu{display:block;height:auto;max-height:292px;overflow:auto}[hidden]{display:none}.mention-dropdown{bottom:100%;margin-bottom:2px;top:auto}"]}]}],m.ctorParameters=function(){return[{type:e.ElementRef}]},m.propDecorators={labelKey:[{type:e.Input}],itemTemplate:[{type:e.Input}],itemClick:[{type:e.Output}],list:[{type:e.ViewChild,args:["list",{static:!0}]}],defaultItemTemplate:[{type:e.ViewChild,args:["defaultItemTemplate",{static:!0}]}]};var u=function(){function t(t,i,n){var o=this;this._element=t,this._componentResolver=i,this._viewContainerRef=n,this.mentionConfig={items:[]},this.DEFAULT_CONFIG={items:[],triggerChar:"@",labelKey:"label",maxItems:-1,allowSpace:!1,returnTrigger:!1,mentionSelect:function(t,e){return o.activeConfig.triggerChar+t[o.activeConfig.labelKey]},mentionFilter:function(t,e){var i=t.toLowerCase();return e.filter((function(t){return t[o.activeConfig.labelKey].toLowerCase().startsWith(i)}))}},this.searchTerm=new e.EventEmitter,this.itemSelected=new e.EventEmitter,this.opened=new e.EventEmitter,this.closed=new e.EventEmitter,this.triggerChars={}}return Object.defineProperty(t.prototype,"mention",{set:function(t){this.mentionItems=t},enumerable:!1,configurable:!0}),t.prototype.ngOnChanges=function(t){(t.mention||t.mentionConfig)&&this.updateConfig()},t.prototype.updateConfig=function(){var t=this,e=this.mentionConfig;this.triggerChars={},this.mentionItems&&(e.items=this.mentionItems),this.addConfig(e),e.mentions&&e.mentions.forEach((function(e){return t.addConfig(e)}))},t.prototype.addConfig=function(t){var e=Object.assign({},this.DEFAULT_CONFIG),i=(t=Object.assign(e,t)).items;i&&i.length>0&&("string"==typeof i[0]&&(i=i.map((function(e){var i={};return i[t.labelKey]=e,i}))),t.labelKey&&(i=i.filter((function(e){return e[t.labelKey]})),t.disableSort||i.sort((function(e,i){return e[t.labelKey].localeCompare(i[t.labelKey])})))),t.items=i,this.triggerChars[t.triggerChar]=t,this.activeConfig&&this.activeConfig.triggerChar==t.triggerChar&&(this.activeConfig=t,this.updateSearchList())},t.prototype.setIframe=function(t){this.iframe=t},t.prototype.stopEvent=function(t){t.wasClick||(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())},t.prototype.blurHandler=function(t){this.stopEvent(t),this.stopSearch()},t.prototype.inputHandler=function(t,e){if(void 0===e&&(e=this._element.nativeElement),229===this.lastKeyCode&&t.data){var i=t.data.charCodeAt(0);this.keyHandler({keyCode:i,inputEvent:!0},e)}},t.prototype.keyHandler=function(t,e){if(void 0===e&&(e=this._element.nativeElement),this.lastKeyCode=t.keyCode,!t.isComposing&&229!==t.keyCode){var i=n(e),r=a(e,this.iframe),l=t.key;if(!l){var h=t.which||t.keyCode;l=!t.shiftKey&&h>=65&&h<=90?String.fromCharCode(h+32):String.fromCharCode(t.which||t.keyCode)}13==t.keyCode&&t.wasClick&&r<this.startPos&&(r=this.startNode.length,s(this.startNode,r,this.iframe));var c=this.triggerChars[l];if(c)this.activeConfig=c,this.startPos=t.inputEvent?r-1:r,this.startNode=(this.iframe?this.iframe.contentWindow.getSelection():window.getSelection()).anchorNode,this.searching=!0,this.searchString=null,this.showSearchList(e),this.updateSearchList(),c.returnTrigger&&this.searchTerm.emit(c.triggerChar);else if(this.startPos>=0&&this.searching)if(r<=this.startPos)this.searchList.hidden=!0;else if(16!==t.keyCode&&!t.metaKey&&!t.altKey&&!t.ctrlKey&&r>this.startPos){if(this.activeConfig.allowSpace||32!==t.keyCode){if(8===t.keyCode&&r>0)--r==this.startPos&&this.stopSearch();else if(!this.searchList.hidden){if(9===t.keyCode||13===t.keyCode){this.stopEvent(t),this.itemSelected.emit(this.searchList.activeItem);var d=this.activeConfig.mentionSelect(this.searchList.activeItem,this.activeConfig.triggerChar);if(o(e,this.startPos,r,d,this.iframe),"createEvent"in document){var f=document.createEvent("HTMLEvents");this.iframe?f.initEvent("change",!0,!1):f.initEvent("input",!0,!1),this._element.nativeElement.dispatchEvent(f)}return this.startPos=-1,this.stopSearch(),!1}if(27===t.keyCode)return this.stopEvent(t),this.stopSearch(),!1;if(40===t.keyCode)return this.stopEvent(t),this.searchList.activateNextItem(),!1;if(38===t.keyCode)return this.stopEvent(t),this.searchList.activatePreviousItem(),!1}}else this.startPos=-1;if(1!=l.length&&8!=t.keyCode)return this.stopEvent(t),!1;if(this.searching){var p=i.substring(this.startPos+1,r);if(8===t.keyCode||t.inputEvent||(p+=l),this.searchString=p,this.activeConfig.returnTrigger){var m=this.searchString||8===t.keyCode?i.substring(this.startPos,this.startPos+1):"";this.searchTerm.emit(m+this.searchString)}else this.searchTerm.emit(this.searchString);this.updateSearchList()}}}},t.prototype.startSearch=function(t,e){void 0===e&&(e=this._element.nativeElement),t=t||this.mentionConfig.triggerChar||this.DEFAULT_CONFIG.triggerChar;var i=a(e,this.iframe);o(e,i,i,t,this.iframe),this.keyHandler({key:t,inputEvent:!0},e)},t.prototype.stopSearch=function(){this.searchList&&!this.searchList.hidden&&(this.searchList.hidden=!0,this.closed.emit()),this.activeConfig=null,this.searching=!1},t.prototype.updateSearchList=function(){var t=[];if(this.activeConfig&&this.activeConfig.items){var e=this.activeConfig.items;!this.activeConfig.disableSearch&&this.searchString&&this.activeConfig.labelKey&&this.activeConfig.mentionFilter&&(e=this.activeConfig.mentionFilter(this.searchString,e)),t=e,this.activeConfig.maxItems>0&&(t=t.slice(0,this.activeConfig.maxItems))}this.searchList&&(this.searchList.items=t,this.searchList.hidden=0==t.length)},t.prototype.showSearchList=function(t){var e=this;if(this.opened.emit(),null==this.searchList){var i=this._componentResolver.resolveComponentFactory(m),n=this._viewContainerRef.createComponent(i);this.searchList=n.instance,this.searchList.itemTemplate=this.mentionListTemplate,n.instance.itemClick.subscribe((function(){t.focus();var i={key:"Enter",keyCode:13,wasClick:!0};e.keyHandler(i,t)}))}this.searchList.labelKey=this.activeConfig.labelKey,this.searchList.dropUp=this.activeConfig.dropUp,this.searchList.styleOff=this.mentionConfig.disableStyle,this.searchList.activeIndex=0,this.searchList.position(t,this.iframe),window.requestAnimationFrame((function(){return e.searchList.reset()}))},t}();u.decorators=[{type:e.Directive,args:[{selector:"[mention], [mentionConfig]",host:{"(keydown)":"keyHandler($event)","(input)":"inputHandler($event)","(blur)":"blurHandler($event)",autocomplete:"off"}}]}],u.ctorParameters=function(){return[{type:e.ElementRef},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef}]},u.propDecorators={mention:[{type:e.Input,args:["mention"]}],mentionConfig:[{type:e.Input}],mentionListTemplate:[{type:e.Input}],searchTerm:[{type:e.Output}],itemSelected:[{type:e.Output}],opened:[{type:e.Output}],closed:[{type:e.Output}]};var g=function(){};g.decorators=[{type:e.NgModule,args:[{declarations:[u,m],imports:[i.CommonModule],exports:[u],entryComponents:[m]}]}],t.MentionDirective=u,t.MentionModule=g,t.ɵa=m,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-mentions.umd.min.js.map